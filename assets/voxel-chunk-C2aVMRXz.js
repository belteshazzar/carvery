(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();const T={add:(e,t)=>new Float32Array([e[0]+t[0],e[1]+t[1],e[2]+t[2]]),ceil:e=>new Float32Array([Math.ceil(e[0]),Math.ceil(e[1]),Math.ceil(e[2])]),clamp:(e,t,i)=>{const n=c=>typeof c=="number",s=n(t)?t:t[0],o=n(t)?t:t[1],r=n(t)?t:t[2],u=n(i)?i:i[0],l=n(i)?i:i[1],a=n(i)?i:i[2];return new Float32Array([Math.min(Math.max(e[0],s),u),Math.min(Math.max(e[1],o),l),Math.min(Math.max(e[2],r),a)])},clone:e=>new Float32Array([e[0],e[1],e[2]]),copy:e=>new Float32Array([e[0],e[1],e[2]]),create:(e=0,t=0,i=0)=>new Float32Array([e,t,i]),cross:(e,t)=>new Float32Array([e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]),distance:(e,t)=>Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])||0,dot:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2],floor:e=>new Float32Array([Math.floor(e[0]),Math.floor(e[1]),Math.floor(e[2])]),length:e=>Math.hypot(e[0],e[1],e[2])||0,lerp:(e,t,i)=>new Float32Array([e[0]+(t[0]-e[0])*i,e[1]+(t[1]-e[1])*i,e[2]+(t[2]-e[2])*i]),mul:(e,t)=>new Float32Array([e[0]*t[0],e[1]*t[1],e[2]*t[2]]),negate:e=>new Float32Array([-e[0],-e[1],-e[2]]),norm:e=>{const t=Math.hypot(e[0],e[1],e[2])||1;return new Float32Array([e[0]/t,e[1]/t,e[2]/t])},normalize:e=>T.norm(e),project:(e,t)=>{const i=T.dot(t,t);if(i===0)return T.create(0,0,0);const n=T.dot(e,t)/i;return T.scale(t,n)},reflect:(e,t)=>{const i=T.dot(e,t);return new Float32Array([e[0]-2*i*t[0],e[1]-2*i*t[1],e[2]-2*i*t[2]])},rotateX:(e,t,i)=>{const n=e[1]-t[1],s=e[2]-t[2],o=Math.sin(i),r=Math.cos(i);return new Float32Array([e[0],t[1]+n*r-s*o,t[2]+n*o+s*r])},rotateY:(e,t,i)=>{const n=e[0]-t[0],s=e[2]-t[2],o=Math.sin(i),r=Math.cos(i);return new Float32Array([t[0]+s*o+n*r,e[1],t[2]+s*r-n*o])},rotateZ:(e,t,i)=>{const n=e[0]-t[0],s=e[1]-t[1],o=Math.sin(i),r=Math.cos(i);return new Float32Array([t[0]+n*r-s*o,t[1]+n*o+s*r,e[2]])},round:e=>new Float32Array([Math.round(e[0]),Math.round(e[1]),Math.round(e[2])]),scale:(e,t)=>new Float32Array([e[0]*t,e[1]*t,e[2]*t]),scaleAndAdd:(e,t,i)=>new Float32Array([e[0]+t[0]*i,e[1]+t[1]*i,e[2]+t[2]*i]),set:(e,t,i)=>new Float32Array([e,t,i]),sub:(e,t)=>new Float32Array([e[0]-t[0],e[1]-t[1],e[2]-t[2]]),transformDirection:(e,t)=>new Float32Array([t[0]*e[0]+t[4]*e[1]+t[8]*e[2],t[1]*e[0]+t[5]*e[1]+t[9]*e[2],t[2]*e[0]+t[6]*e[1]+t[10]*e[2]]),transformMat4:(e,t)=>{const i=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12],n=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13],s=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14],o=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15];return o===0||o===1?new Float32Array([i,n,s]):new Float32Array([i/o,n/o,s/o])}},M={identity:()=>new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),perspective:(e,t,i,n)=>{const s=1/Math.tan(e/2),o=1/(i-n),r=new Float32Array(16);return r[0]=s/t,r[5]=s,r[10]=(n+i)*o,r[11]=-1,r[14]=2*n*i*o,r},orthographic:(e,t,i,n,s,o)=>{const r=new Float32Array(16),u=t-e,l=n-i,a=o-s;return r[0]=2/u,r[5]=2/l,r[10]=-2/a,r[15]=1,r[12]=-(t+e)/u,r[13]=-(n+i)/l,r[14]=-(o+s)/a,r},frustum:(e,t,i,n,s,o)=>{const r=new Float32Array(16),u=1/(t-e),l=1/(n-i),a=1/(s-o);return r[0]=2*s*u,r[5]=2*s*l,r[8]=(t+e)*u,r[9]=(n+i)*l,r[10]=(o+s)*a,r[11]=-1,r[14]=2*o*s*a,r},lookAt:(e,t,i)=>{const n=T.norm(T.sub(e,t)),s=T.norm(new Float32Array([i[1]*n[2]-i[2]*n[1],i[2]*n[0]-i[0]*n[2],i[0]*n[1]-i[1]*n[0]])),o=new Float32Array([n[1]*s[2]-n[2]*s[1],n[2]*s[0]-n[0]*s[2],n[0]*s[1]-n[1]*s[0]]),r=new Float32Array(16);return r[0]=s[0],r[1]=o[0],r[2]=n[0],r[3]=0,r[4]=s[1],r[5]=o[1],r[6]=n[1],r[7]=0,r[8]=s[2],r[9]=o[2],r[10]=n[2],r[11]=0,r[12]=-(s[0]*e[0]+s[1]*e[1]+s[2]*e[2]),r[13]=-(o[0]*e[0]+o[1]*e[1]+o[2]*e[2]),r[14]=-(n[0]*e[0]+n[1]*e[1]+n[2]*e[2]),r[15]=1,r},translate:(e,t,i)=>{const n=M.identity();return n[12]=e,n[13]=t,n[14]=i,n},rotationX:e=>{const t=Math.cos(e),i=Math.sin(e),n=M.identity();return n[5]=t,n[6]=i,n[9]=-i,n[10]=t,n},rotationY:e=>{const t=Math.cos(e),i=Math.sin(e),n=M.identity();return n[0]=t,n[2]=-i,n[8]=i,n[10]=t,n},rotationZ:e=>{const t=Math.cos(e),i=Math.sin(e),n=M.identity();return n[0]=t,n[1]=i,n[4]=-i,n[5]=t,n},rotate:(e,t,i,n)=>{const s=Math.hypot(t,i,n);if(s===0)return M.identity();t/=s,i/=s,n/=s;const o=Math.cos(e),r=Math.sin(e),u=1-o,l=new Float32Array(16);return l[0]=t*t*u+o,l[1]=i*t*u+n*r,l[2]=n*t*u-i*r,l[3]=0,l[4]=t*i*u-n*r,l[5]=i*i*u+o,l[6]=n*i*u+t*r,l[7]=0,l[8]=t*n*u+i*r,l[9]=i*n*u-t*r,l[10]=n*n*u+o,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},scaleMatrix:(e,t,i)=>{const n=M.identity();return n[0]=e,n[5]=t,n[10]=i,n},fromTRS:(e,t,i)=>{const n=M.scaleMatrix(i[0],i[1],i[2]),s=t,o=M.translate(e[0],e[1],e[2]);return M.multiply(o,s,n)},multiply:(...e)=>{if(e.length===0)return M.identity();if(e.length===1)return e[0];let t=e[0];for(let i=1;i<e.length;i++)t=M.multiplyTwo(t,e[i]);return t},multiplyTwo:(e,t)=>{const i=new Float32Array(16);for(let n=0;n<4;n++)for(let s=0;s<4;s++)i[s*4+n]=e[0+n]*t[s*4+0]+e[4+n]*t[s*4+1]+e[8+n]*t[s*4+2]+e[12+n]*t[s*4+3];return i},transpose:e=>{const t=new Float32Array(16);return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},invert:e=>{const t=e,i=new Float32Array(16),n=t[0]*t[5]-t[1]*t[4],s=t[0]*t[6]-t[2]*t[4],o=t[0]*t[7]-t[3]*t[4],r=t[1]*t[6]-t[2]*t[5],u=t[1]*t[7]-t[3]*t[5],l=t[2]*t[7]-t[3]*t[6],a=t[8]*t[13]-t[9]*t[12],c=t[8]*t[14]-t[10]*t[12],h=t[8]*t[15]-t[11]*t[12],f=t[9]*t[14]-t[10]*t[13],m=t[9]*t[15]-t[11]*t[13],p=t[10]*t[15]-t[11]*t[14],g=n*p-s*m+o*f+r*h-u*c+l*a;if(!g)return null;const d=1/g;return i[0]=(t[5]*p-t[6]*m+t[7]*f)*d,i[1]=(-t[1]*p+t[2]*m-t[3]*f)*d,i[2]=(t[13]*l-t[14]*u+t[15]*r)*d,i[3]=(-t[9]*l+t[10]*u-t[11]*r)*d,i[4]=(-t[4]*p+t[6]*h-t[7]*c)*d,i[5]=(t[0]*p-t[2]*h+t[3]*c)*d,i[6]=(-t[12]*l+t[14]*o-t[15]*s)*d,i[7]=(t[8]*l-t[10]*o+t[11]*s)*d,i[8]=(t[4]*m-t[5]*h+t[7]*a)*d,i[9]=(-t[0]*m+t[1]*h-t[3]*a)*d,i[10]=(t[12]*u-t[13]*o+t[15]*n)*d,i[11]=(-t[8]*u+t[9]*o-t[11]*n)*d,i[12]=(-t[4]*f+t[5]*c-t[6]*a)*d,i[13]=(t[0]*f-t[1]*c+t[2]*a)*d,i[14]=(-t[12]*r+t[13]*s-t[14]*n)*d,i[15]=(t[8]*r-t[9]*s+t[10]*n)*d,i},transform:(e,t)=>{const i=t[0],n=t[1],s=t[2],o=t.length===4?t[3]:1;return[e[0]*i+e[4]*n+e[8]*s+e[12]*o,e[1]*i+e[5]*n+e[9]*s+e[13]*o,e[2]*i+e[6]*n+e[10]*s+e[14]*o,e[3]*i+e[7]*n+e[11]*s+e[15]*o]},transformPoint:(e,t)=>{const i=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12],n=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13],s=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14],o=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15];return o===0||o===1?new Float32Array([i,n,s]):new Float32Array([i/o,n/o,s/o])},transformDirection:(e,t)=>new Float32Array([e[0]*t[0]+e[4]*t[1]+e[8]*t[2],e[1]*t[0]+e[5]*t[1]+e[9]*t[2],e[2]*t[0]+e[6]*t[1]+e[10]*t[2]]),normalMatrix:e=>{const t=e[0],i=e[4],n=e[8],s=e[1],o=e[5],r=e[9],u=e[2],l=e[6],a=e[10],c=t*(o*a-r*l)-i*(s*a-r*u)+n*(s*l-o*u);if(!c)return new Float32Array([1,0,0,0,1,0,0,0,1]);const h=1/c,f=(o*a-r*l)*h,m=(n*l-i*a)*h,p=(i*r-n*o)*h,g=(r*u-s*a)*h,d=(t*a-n*u)*h,x=(n*s-t*r)*h,w=(s*l-o*u)*h,N=(i*u-t*l)*h,I=(t*o-i*s)*h;return new Float32Array([f,m,p,g,d,x,w,N,I])}};function Q(e){return e*(Math.PI/180)}class tt{constructor({target:t=[0,0,0],radius:i=2.3,minRadius:n=.3,maxRadius:s=100,theta:o=.9,phi:r=.9}={}){this.target=Float32Array.from(t),this.radius=i,this.minRadius=n,this.maxRadius=s,this.theta=o,this.phi=r,this.up=T.create(0,1,0)}clamp(){const n=Math.PI-.001;this.phi=Math.max(.001,Math.min(n,this.phi)),this.radius=Math.max(this.minRadius,Math.min(this.maxRadius,this.radius)),this.theta>Math.PI&&(this.theta-=2*Math.PI),this.theta<-Math.PI&&(this.theta+=2*Math.PI)}getEye(){const t=Math.sin(this.phi),i=Math.cos(this.phi),n=this.radius*Math.cos(this.theta)*t,s=this.radius*i,o=this.radius*Math.sin(this.theta)*t;return new Float32Array([this.target[0]+n,this.target[1]+s,this.target[2]+o])}view(){return M.lookAt(this.getEye(),this.target,this.up)}}function et(){const e=new Float32Array([-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5]),t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);return{positions:e,indices:t,count:t.length}}function it(e=16,t=16){const i=[],n=[],s=[.2,.2,.2];for(let r=1;r<=e;r++)i.push(r,-.01,0,r,-.01,t),n.push(...s,...s);for(let r=1;r<=t;r++)i.push(0,-.01,r,e,-.01,r),n.push(...s,...s);const o=Math.max(e,t)+4;return i.push(0,0,0,o,0,0,0,0,0,0,o,0,0,0,0,0,0,o),n.push(1,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,1),{positions:new Float32Array(i),colors:new Float32Array(n),count:i.length/3}}function nt(){const e=new Float32Array([-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5]),t=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),i=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);return{positions:e,normals:t,indices:i,count:i.length}}const D=new Map;function X(e,t,i){const n=e.createShader(t);if(e.shaderSource(n,i),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){const s=e.getShaderInfoLog(n);throw e.deleteShader(n),new Error(`Shader compile failed:
`+s)}return n}function st(e,t,i){if(D.size===0)for(const a in e)typeof e[a]=="number"&&D.set(e[a],a);const n=X(e,e.VERTEX_SHADER,t),s=X(e,e.FRAGMENT_SHADER,i),o=e.createProgram();if(e.attachShader(o,n),e.attachShader(o,s),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS)){const a=e.getProgramInfoLog(o);throw e.deleteProgram(o),new Error(`Program link failed:
`+a)}const r={program:o,meta:{},vao:e.createVertexArray()},u=e.getProgramParameter(o,e.ACTIVE_ATTRIBUTES);for(let a=0;a<u;a++){const c=e.getActiveAttrib(o,a),h=e.getAttribLocation(o,c.name);r[z(c.name)]={kind:"attribute",location:h,type:c.type,typeName:D.get(c.type),size:c.size}}const l=e.getProgramParameter(o,e.ACTIVE_UNIFORMS);for(let a=0;a<l;a++){const c=e.getActiveUniform(o,a),h=e.getUniformLocation(o,c.name);if(r[z(c.name)]={kind:"uniform",location:h,type:c.type,typeName:D.get(c.type),size:c.size},c.type===e.FLOAT_MAT4?r[z(c.name)].set=function(f){e.uniformMatrix4fv(h,!1,f)}:c.type===e.FLOAT_MAT3?r[z(c.name)].set=function(f){e.uniformMatrix3fv(h,!1,f)}:c.type===e.FLOAT_VEC3?r[z(c.name)].set=function(f){e.uniform3fv(h,f)}:c.type===e.FLOAT?r[z(c.name)].set=function(f){e.uniform1f(h,f)}:c.type===e.INT?r[z(c.name)].set=function(f){e.uniform1i(h,f)}:c.type===e.UNSIGNED_INT?r[z(c.name)].set=function(f){e.uniform1ui(h,f)}:c.type===e.SAMPLER_2D?r[z(c.name)].set=function(f){e.uniform1i(h,f)}:c.type===e.SAMPLER_CUBE?r[z(c.name)].set=function(f){e.uniform1i(h,f)}:console.warn("Unhandled uniform type:",D.get(c.type),"for uniform",c.name),c.size>1){const f=z(c.name);c.type===e.FLOAT_VEC3?r[f].set=function(m){e.uniform3fv(h,m)}:c.type===e.FLOAT?r[f].set=function(m){e.uniform1fv(h,m)}:c.type===e.UNSIGNED_INT&&(r[f].set=function(m){e.uniform1uiv(h,m)})}}return r}function z(e){return e.replace(/\[.*\]/,"")}var ot=`#version 300 es

precision mediump float;

in vec3 vNormalWS;
flat in uint vMatId;

uniform vec3 uPalette[16];
uniform vec3 uLightDirWS;
uniform float uAmbient;

out vec4 fragColor;

void main(){
  vec3 base = uPalette[int(vMatId)];
  float NdotL = max(dot(normalize(vNormalWS), normalize(-uLightDirWS)), 0.0);
  float lambert = uAmbient + (1.0 - uAmbient) * NdotL;
  vec3 rgb = pow(base * lambert, vec3(1.0/1.8));
  fragColor = vec4(rgb, 1.0);
}`,rt=`#version 300 es

precision mediump float;

in vec3 aPosition;
in vec3 aNormal;
in uint aMatId;

uniform mat4 uModel, uView, uProj;
uniform mat3 uNormalMat;

out vec3 vNormalWS;
flat out uint vMatId;

void main(){
  vec4 worldPos = uModel * vec4(aPosition, 1.0);
  vNormalWS = normalize(uNormalMat * aNormal);
  vMatId = aMatId;
  gl_Position = uProj * uView * worldPos;
}`,at=`#version 300 es
precision mediump float;
uniform vec3 uColor;
out vec4 fragColor;
void main(){ fragColor = vec4(uColor, 1.0); }`,ct=`#version 300 es
precision mediump float;
in vec3 aPosition;
uniform mat4 uModel, uView, uProj;
uniform vec3 uOffset;     
uniform vec3 uScaleVec;   
uniform float uInflate;
void main(){
  vec3 p = (aPosition * uInflate) * uScaleVec + uOffset;
  gl_Position = uProj * uView * uModel * vec4(p, 1.0);
}`,lt=`#version 300 es

precision mediump float;

flat in uint vPacked;

out vec4 fragColor;

void main(){
  uint r=(vPacked)&255u, g=(vPacked>>8)&255u, b=(vPacked>>16)&255u;
  fragColor=vec4(vec3(float(r),float(g),float(b))/255.0,1.0);
}`,ut=`#version 300 es

precision mediump float;

in vec3 aPosition;
in uint aPacked; 

uniform mat4 uModel, uView, uProj;

flat out uint vPacked;

void main(){
  vPacked = aPacked;
  gl_Position = uProj * uView * uModel * vec4(aPosition, 1.0);
}`,ht=`#version 300 es

precision mediump float;

in vec3 vColor;
out vec4 fragColor;

void main() {
  fragColor = vec4(vColor, 1.0);
}`,ft=`#version 300 es

precision mediump float;

uniform mat4 uModel;
uniform mat4 uView;
uniform mat4 uProj;
in vec3 aPosition;
in vec3 aColor;
out vec3 vColor;

void main() {
  
  vec3 pos = aPosition;
  gl_Position = uProj * uView * uModel * vec4(pos, 1.0);
  vColor = aColor;
}`,dt=`#version 300 es

precision mediump float;

in vec3 vNormalWS;
flat in uint vMatId;
flat in float vAlpha;

uniform vec3 uPalette[16];
uniform vec3 uLightDirWS;
uniform float uAmbient;

out vec4 fragColor;

void main(){
  vec3 base = uPalette[int(vMatId)];
  float NdotL = max(dot(normalize(vNormalWS), normalize(-uLightDirWS)), 0.0);
  float lambert = uAmbient + (1.0 - uAmbient) * NdotL;
  vec3 rgb = pow(base * lambert, vec3(1.0/1.8));
  fragColor = vec4(rgb, vAlpha);
}`,mt=`#version 300 es

precision highp float;

in vec3 aPosition;
in vec3 aNormal;
in uint aMatId;

uniform mat4 uView, uProj;
uniform sampler2D uParticleData;  

uniform int uTextureWidth;        

out vec3 vNormalWS;
flat out uint vMatId;
flat out float vAlpha;

void main(){
  int instanceId = gl_InstanceID;
  
  
  int particleIndex = instanceId * 2;  
  int pixelX0 = particleIndex % uTextureWidth;
  int pixelY0 = particleIndex / uTextureWidth;
  int pixelX1 = (particleIndex + 1) % uTextureWidth;
  int pixelY1 = (particleIndex + 1) / uTextureWidth;
  
  
  vec4 data0 = texelFetch(uParticleData, ivec2(pixelX0, pixelY0), 0);
  vec4 data1 = texelFetch(uParticleData, ivec2(pixelX1, pixelY1), 0);
  
  
  vec3 particlePos = data0.rgb;
  float particleSize = data0.a;
  vMatId = uint(data1.r * 255.0);  
  vAlpha = data1.g;
  
  
  vec3 worldPos = particlePos + aPosition * particleSize;
  vNormalWS = aNormal;
  
  gl_Position = uProj * uView * vec4(worldPos, 1.0);
}`;const G=e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16)/255,parseInt(t[2],16)/255,parseInt(t[3],16)/255]:[1,1,1]},W=e=>("0"+Math.round(e*255).toString(16)).slice(-2),J=(e,t,i)=>"#"+W(e)+W(t)+W(i),Z=["#e76f51","#f4a261","#e9c46a","#2a9d8f","#264653","#a8dadc","#457b9d","#1d3557","#ff6b6b","#ffd93d","#6bcb77","#4d96ff","#b983ff","#ff4d6d","#9ef01a","#00f5d4"];class pt{constructor(t,i,n){this.container=t,this.colors=new Float32Array(48),this.onBrushChange=i,this.onColorChange=n,this.brushMat=0,this.pickers=new Map,this.build()}build(){for(let t=0;t<16;t++){const[i,n,s]=G(Z[t]);this.setPaletteColor(t,[i,n,s])}this.container&&(this.container.innerHTML=""),this.pickers.clear();for(let t=0;t<16;t++){const i=J(this.colors[t*3+0],this.colors[t*3+1],this.colors[t*3+2]),n=document.createElement("div");n.className="swatch",t===this.brushMat&&n.classList.add("active"),n.title=`Left click: Select material ${t}
${navigator.platform.includes("Mac")?"Control+click":"Right click"}: Edit color`;const s=document.createElement("div");s.className="idx",s.textContent=t.toString(16).toLowerCase();const o=document.createElement("div");o.className="color",o.style.background=i;const r=document.createElement("input");r.type="color",r.value=i,r.style.position="absolute",r.style.opacity="0",r.style.pointerEvents="none",this.pickers.set(t,r);const u=l=>{l.preventDefault(),l.stopPropagation();const a=r.value,c=()=>{const f=r.value,[m,p,g]=G(f);this.setPaletteColor(t,[m,p,g]),o.style.background=f,f!==a&&this.onColorChange(t,a,f)},h=()=>{r.removeEventListener("input",c),r.removeEventListener("change",h)};r.addEventListener("input",c),r.addEventListener("change",h),r.showPicker(),console.log("Opened color picker for swatch",t)};n.addEventListener("click",l=>{l.ctrlKey||this.selectBrush(t)}),n.addEventListener("contextmenu",u),n.appendChild(s),n.appendChild(r),n.appendChild(o),this.container&&this.container.appendChild(n)}}reset(){for(let t=0;t<16;t++){const[i,n,s]=G(Z[t]);this.setPaletteColor(t,[i,n,s])}}setPaletteColor(t,i){this.colors[t*3+0]=i[0],this.colors[t*3+1]=i[1],this.colors[t*3+2]=i[2];const n=J(i[0],i[1],i[2]),s=this.container?.querySelectorAll(".swatch");if(s&&s[t]){const r=s[t].querySelector(".color");r&&(r.style.background=n)}const o=this.pickers.get(t);o&&(o.value=n)}selectBrush(t){this.brushMat=t&15,this.container&&this.container.querySelectorAll(".swatch").forEach(n=>n.classList.remove("active"));const i=this.container?.querySelectorAll(".swatch");i[this.brushMat]&&i[this.brushMat].classList.add("active"),this.onBrushChange&&this.onBrushChange(this.brushMat)}getBrush(){return this.brushMat}}const k={linear:e=>e,ease:e=>{const t=e*e,i=t*e;return 3*t-2*i},"ease-in":e=>e*e*e,"ease-out":e=>{const t=e-1;return t*t*t+1},"ease-in-out":e=>{if(e<.5)return 4*e*e*e;{const t=2*e-2;return 1+t*t*t/2}},"ease-in-back":e=>2.70158*e*e*e-1.70158*e*e,"ease-out-back":e=>{const n=e-1;return 1+2.70158*n*n*n+1.70158*n*n},"ease-in-out-back":e=>{const i=2.5949095;if(e<.5){const n=2*e;return n*n*((i+1)*2*e-i)/2}else{const n=2*e-2;return(n*n*((i+1)*n+i)+2)/2}},"ease-in-bounce":e=>1-k["ease-out-bounce"](1-e),"ease-out-bounce":e=>{if(e<1/2.75)return 7.5625*e*e;if(e<2/2.75){const n=e-.5454545454545454;return 7.5625*n*n+.75}else if(e<2.5/2.75){const n=e-.8181818181818182;return 7.5625*n*n+.9375}else{const n=e-.9545454545454546;return 7.5625*n*n+.984375}},"ease-in-out-bounce":e=>e<.5?(1-k["ease-out-bounce"](1-2*e))/2:(1+k["ease-out-bounce"](2*e-1))/2,"ease-in-elastic":e=>{const t=2*Math.PI/3;return e===0?0:e===1?1:-Math.pow(2,10*e-10)*Math.sin((e*10-10.75)*t)},"ease-out-elastic":e=>{const t=2*Math.PI/3;return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e*10-.75)*t)+1},"ease-in-out-elastic":e=>{const t=2*Math.PI/4.5;return e===0?0:e===1?1:e<.5?-(Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*t))/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*t)/2+1},steps:(e,t=10)=>Math.floor(e*t)/t,sine:e=>1-Math.cos(e*Math.PI/2),expo:e=>e===0?0:e===1?1:Math.pow(2,10*(e-1)),circ:e=>1-Math.sqrt(1-e*e)};function q(e,t,i){if(!e||e==="linear")return t;const n=k[e];return n?e==="steps"&&i!==void 0?n(t,i):n(t):(console.warn(`Unknown easing function: ${e}, using linear`),t)}class Y{constructor(t){this.name=t,this.regionName=null,this.region=null,this.keyframes=[],this.loop=!1,this.time=0,this.playing=!1}_updateRegionTransform(){if(!this.region)return;let t=M.identity(),i=0,n=this.time;const s=this.getTotalDuration();!this.loop&&s>0&&n>s&&(n=s);for(const o of this.keyframes){const r=Math.max(0,Math.min(o.duration,n-i));let u=o.duration>0?r/o.duration:1;switch(o.easing&&(u=q(o.easing,u,o.steps)),o.type){case"rotate":{const l=o.from+(o.to-o.from)*u,a=o.pivot||[0,0,0],c=o.axis||[0,1,0],h=M.rotate(l*Math.PI/180,...c),f=M.translate(-a[0],-a[1],-a[2]),m=M.translate(...a);t=M.multiply(t,m,h,f);break}case"move":{const l=o.delta*u,a=o.axis==="x"?[l,0,0]:o.axis==="y"?[0,l,0]:[0,0,l];t=M.multiply(t,M.translate(...a));break}}if(i+=o.duration,n<i)break}this.region.transform=t}update(t){if(!this.playing)return;this.time+=t;const i=this.getTotalDuration();this.loop&&i>0&&this.time>i?this.time=this.time%i:!this.loop&&i>0&&this.time>=i&&(this.time=i,this.playing=!1),this._updateRegionTransform()}play(){this.playing=!0}stop(){this.playing=!1}reset(){this.time=0,this.playing=!1}getTotalDuration(){return this.keyframes.reduce((t,i)=>t+i.duration,0)}toJSON(){return{regionName:this.regionName,loop:this.loop,keyframes:this.keyframes.map(t=>({...t}))}}static fromJSON(t,i){const n=new Y(t);return n.regionName=i.regionName,n.loop=i.loop||!1,n.keyframes=i.keyframes.map(s=>({...s})),n}}class O{constructor(t){this.name=t,this.min=[0,0,0],this.max=[0,0,0],this.voxels=new Set,this.transform=null,this.state=null,this.initialState=null}toJSON(){return{min:[...this.min],max:[...this.max]}}static fromJSON(t,i){const n=new O(t);return n.min=[...i.min],n.max=[...i.max],n}}class H{constructor(t,i,n,s,o=.2){this.position=[...t],this.velocity=[...i],this.color=n,this.lifetime=s,this.age=0,this.size=o,this.active=!0}update(t,i=[0,-9.8,0]){if(this.active){if(this.age+=t,this.age>=this.lifetime){this.active=!1;return}this.position[0]+=this.velocity[0]*t,this.position[1]+=this.velocity[1]*t,this.position[2]+=this.velocity[2]*t,this.velocity[0]+=i[0]*t,this.velocity[1]+=i[1]*t,this.velocity[2]+=i[2]*t}}isAlive(){return this.active&&this.age<this.lifetime}getAlpha(){const t=this.lifetime*.8;return this.age<t?1:1-(this.age-t)/(this.lifetime-t)}}class U{constructor(t){this.name=t,this.position=[0,0,0],this.enabled=!1,this.rate=10,this.particleLifetime=2,this.particleSize=.2,this.velocityBase=[0,5,0],this.velocitySpread=[1,1,1],this.colorIds=[0],this.gravity=[0,-9.8,0],this.particles=[],this.timeSinceEmit=0,this.maxParticles=1e3}update(t){if(!this.enabled)return;for(let n=this.particles.length-1;n>=0;n--){const s=this.particles[n];s.update(t,this.gravity),s.isAlive()||this.particles.splice(n,1)}this.timeSinceEmit+=t;const i=1/this.rate;for(;this.timeSinceEmit>=i&&this.particles.length<this.maxParticles;)this.emitParticle(),this.timeSinceEmit-=i}emitParticle(){const t=this.velocityBase[0]+(Math.random()-.5)*this.velocitySpread[0]*2,i=this.velocityBase[1]+(Math.random()-.5)*this.velocitySpread[1]*2,n=this.velocityBase[2]+(Math.random()-.5)*this.velocitySpread[2]*2,s=this.colorIds[Math.floor(Math.random()*this.colorIds.length)],o=new H([...this.position],[t,i,n],s,this.particleLifetime,this.particleSize);this.particles.push(o)}start(){this.enabled=!0}stop(){this.enabled=!1}clear(){this.particles=[],this.timeSinceEmit=0}reset(){this.stop(),this.clear()}toJSON(){return{position:[...this.position],rate:this.rate,particleLifetime:this.particleLifetime,particleSize:this.particleSize,velocityBase:[...this.velocityBase],velocitySpread:[...this.velocitySpread],colorIds:[...this.colorIds],gravity:[...this.gravity],maxParticles:this.maxParticles}}static fromJSON(t,i){const n=new U(t);return n.position=[...i.position],n.rate=i.rate||10,n.particleLifetime=i.particleLifetime||2,n.particleSize=i.particleSize||.2,n.velocityBase=i.velocityBase?[...i.velocityBase]:[0,5,0],n.velocitySpread=i.velocitySpread?[...i.velocitySpread]:[1,1,1],n.colorIds=i.colorIds?[...i.colorIds]:[0],n.gravity=i.gravity?[...i.gravity]:[0,-9.8,0],n.maxParticles=i.maxParticles||1e3,n}}class V{constructor(t){this.name=t,this.animationNames=[],this.emitterNames=[],this.guard=null,this.endState=null}addAnimation(t){this.animationNames.includes(t)||this.animationNames.push(t)}addEmitter(t){this.emitterNames.includes(t)||this.emitterNames.push(t)}toJSON(){return{animations:this.animationNames,emitters:this.emitterNames,guard:this.guard,endState:this.endState}}static fromJSON(t,i){const n=new V(t);return i.animations&&(n.animationNames=[...i.animations]),i.emitters&&(n.emitterNames=[...i.emitters]),n.guard=i.guard||null,n.endState=i.endState||null,n}}class At{constructor(){this.regions=new Map,this.animations=new Map,this.emitters=new Map,this.groups=new Map}addRegion(t,i=[0,0,0],n=[1,1,1]){if(this.regions.has(t))throw new Error(`Region "${t}" already exists`);const s=new O(t);return s.min=[...i],s.max=[...n],s.state="default",s.initialState="default",this.regions.set(t,s),s}removeRegion(t){if(!this.regions.has(t))return!1;this.regions.delete(t);for(const[i,n]of this.animations.entries())n.regionName===t&&this.animations.delete(i);return!0}renameRegion(t,i){if(!this.regions.has(t))throw new Error(`Region "${t}" does not exist`);if(this.regions.has(i))throw new Error(`Region "${i}" already exists`);if(t===i)return;const n=this.regions.get(t);n.name=i,this.regions.delete(t),this.regions.set(i,n);for(const s of this.animations.values())s.regionName===t&&(s.regionName=i,s.region=n);return!0}generateUniqueRegionName(t="region"){let i=1,n=t;for(;this.regions.has(n);)n=`${t}${i}`,i++;return n}generateUniqueAnimationName(t="anim"){let i=1,n=t;for(;this.animations.has(n);)n=`${t}${i}`,i++;return n}generateUniqueEmitterName(t="emitter"){let i=1,n=t;for(;this.emitters.has(n);)n=`${t}${i}`,i++;return n}generateUniqueGroupName(t="group"){let i=1,n=t;for(;this.groups.has(n);)n=`${t}${i}`,i++;return n}addAnimation(t,i=null){if(this.animations.has(t))throw new Error(`Animation "${t}" already exists`);const n=new Y(t);return n.regionName=i,i&&this.regions.has(i)&&(n.region=this.regions.get(i)),this.animations.set(t,n),n}removeAnimation(t){return this.animations.has(t)?(this.animations.delete(t),!0):!1}addEmitter(t){if(this.emitters.has(t))throw new Error(`Emitter "${t}" already exists`);const i=new U(t);return this.emitters.set(t,i),i}removeEmitter(t){if(!this.emitters.has(t))return!1;this.emitters.delete(t);for(const i of this.groups.values()){const n=i.emitterNames.indexOf(t);n!==-1&&i.emitterNames.splice(n,1)}return!0}addGroup(t){if(this.groups.has(t))throw new Error(`Group "${t}" already exists`);const i=new V(t);return this.groups.set(t,i),i}removeGroup(t){return this.groups.has(t)?(this.groups.delete(t),!0):!1}linkAnimationsToRegions(){for(const t of this.animations.values())t.regionName&&this.regions.has(t.regionName)&&(t.region=this.regions.get(t.regionName),console.log(`Linked animation ${t.name} to region ${t.regionName}`))}parseArray(t){const i=t.match(/\[(.*?)\]/);return i?i[1].split(",").map(n=>parseFloat(n.trim())):[0,0,0]}fromJSON(t){if(this.regions.clear(),this.animations.clear(),this.emitters.clear(),this.groups.clear(),t.regions&&typeof t.regions=="object")for(const[i,n]of Object.entries(t.regions)){const s=O.fromJSON(i,n);this.regions.set(i,s)}if(t.animations&&typeof t.animations=="object")for(const[i,n]of Object.entries(t.animations)){const s=Y.fromJSON(i,n);this.animations.set(i,s)}if(t.emitters&&typeof t.emitters=="object")for(const[i,n]of Object.entries(t.emitters)){const s=U.fromJSON(i,n);this.emitters.set(i,s)}if(t.groups&&typeof t.groups=="object")for(const[i,n]of Object.entries(t.groups)){const s=V.fromJSON(i,n);this.groups.set(i,s)}this.linkAnimationsToRegions(),console.log("Loaded Animation System from JSON:",this)}toJSON(){const t={};for(const[o,r]of this.regions.entries())t[o]=r.toJSON();const i={};for(const[o,r]of this.animations.entries())i[o]=r.toJSON();const n={};for(const[o,r]of this.emitters.entries())n[o]=r.toJSON();const s={};for(const[o,r]of this.groups.entries())s[o]=r.toJSON();return{regions:t,animations:i,emitters:n,groups:s}}assignVoxelsToRegions(t){for(const i of this.regions.values())i.voxels.clear();for(const i of this.regions.values()){const[n,s,o]=i.min,[r,u,l]=i.max;for(let a=o;a<=l;a++)for(let c=s;c<=u;c++)for(let h=n;h<=r;h++){const f=t.idx3(h,c,a);t.isSolid(f)&&i.voxels.add(f)}}}update(t){for(const i of this.animations.values())i.update(t);for(const i of this.emitters.values())i.update(t);for(const i of this.groups.values())if(i.playing&&i.endState!==null){let n=!0;for(const s of i.animationNames){const o=this.animations.get(s);if(o&&o.playing){n=!1;break}}if(n){for(const s of i.animationNames){const o=this.animations.get(s);o&&o.region&&(o.region.state=i.endState,console.log(`Group ${i.name} completed, setting region ${o.region.name} state to ${i.endState}`))}i.playing=!1}}}playAnimation(t){const i=this.animations.get(t);if(i){if(i.regionName)for(const n of this.animations.values())n!==i&&n.regionName===i.regionName&&n.playing&&n.stop();i.reset(),i.play()}else console.warn("Animation not found:",t)}stopAnimation(t){const i=this.animations.get(t);i?i.stop():console.warn("Animation not found:",t)}resetAnimation(t){const i=this.animations.get(t);i?i.reset():console.warn("Animation not found:",t)}resetAll(){for(const t of this.animations.values())t.stop(),t.reset();for(const t of this.emitters.values())t.reset()}startEmitter(t){const i=this.emitters.get(t);i?i.start():console.warn("Emitter not found:",t)}stopEmitter(t){const i=this.emitters.get(t);i?i.stop():console.warn("Emitter not found:",t)}clearEmitter(t){const i=this.emitters.get(t);i?i.clear():console.warn("Emitter not found:",t)}playGroup(t){const i=this.groups.get(t);if(!i){console.warn("Group not found:",t);return}if(i.guard!==null){let n=!1;for(const s of i.animationNames){const o=this.animations.get(s);if(o&&o.region&&o.region.state===i.guard){n=!0;break}}if(!n){console.log(`Group ${t} cannot play, guard state "${i.guard}" not met.`);return}}i.playing=!0,i.startTime=performance.now();for(const n of i.animationNames)this.playAnimation(n);for(const n of i.emitterNames)this.startEmitter(n)}stopGroup(t){const i=this.groups.get(t);if(!i){console.warn("Group not found:",t);return}i.playing=!1;for(const n of i.animationNames)this.stopAnimation(n);for(const n of i.emitterNames)this.stopEmitter(n)}resetGroup(t){const i=this.groups.get(t);if(!i){console.warn("Group not found:",t);return}i.playing=!1;for(const n of i.animationNames)this.resetAnimation(n);for(const n of i.emitterNames)this.clearEmitter(n)}getAllParticles(){const t=[];for(const i of this.emitters.values())t.push(...i.particles);return t}getRegionTransform(t){const i=this.regions.get(t);return i&&i.transform||M.identity()}getAnimationsForRegion(t){return Array.from(this.animations.values()).filter(i=>i.regionName===t)}}const j=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1],[0,0,0]];class K{constructor(t,i,n){this._chunk=t,this._mask=new Array(t.length).fill(!1);for(let s=i[0];s<=n[0];s++)for(let o=i[1];o<=n[1];o++)for(let r=i[2];r<=n[2];r++){if(!t.within(s,o,r))continue;const u=t.idx3(s,o,r);this._mask[u]=!0}}contains(t){return this._mask[t]}}class yt{constructor(t){this._size=t,this._isSolid=new Array(t*t*t).fill(!0),this._material=new Uint8Array(t*t*t),this._regions=new Map}clearRegions(){this._regions.clear()}addRegion(t,i,n){const s=new K(this,i,n);this._regions.set(t,s)}fill(t){this._isSolid.fill(t)}get length(){return this._isSolid.length}isSolid(t){return this._isSolid[t]}setSolid(t,i){this._isSolid[t]=i}material(t){return this._material[t]}setMaterial(t,i){this._material[t]=i}setMaterialAll(t){this._material.fill(t)}idx3(t,i,n){const s=this._sizeX||this._size,o=this._sizeY||this._size;return t+s*(i+o*n)}within(t,i,n){const s=this._sizeX||this._size,o=this._sizeY||this._size,r=this._sizeZ||this._size;return t>=0&&i>=0&&n>=0&&t<s&&i<o&&n<r}coordsOf(t){const i=this._sizeX||this._size,n=this._sizeY||this._size,s=Math.floor(t/(i*n)),o=Math.floor((t-s*i*n)/i);return[t-s*i*n-o*i,o,s]}expandSize(t,i,n){const s=this._sizeX||this._size,o=this._sizeY||this._size,r=this._sizeZ||this._size,u=this._isSolid,l=this._material;this._sizeX=t,this._sizeY=i,this._sizeZ=n,this._size=Math.max(t,i,n);const a=t*i*n;this._isSolid=new Array(a).fill(!1),this._material=new Uint8Array(a);for(let c=0;c<r&&c<n;c++)for(let h=0;h<o&&h<i;h++)for(let f=0;f<s&&f<t;f++){const m=f+s*(h+o*c),p=f+t*(h+i*c);this._isSolid[p]=u[m],this._material[p]=l[m]}this._regions.clear()}resetSize(){this._size=16,this._sizeX=void 0,this._sizeY=void 0,this._sizeZ=void 0,this._isSolid=new Array(256*16).fill(!0),this._material=new Uint8Array(256*16),this._regions.clear()}get sizeX(){return this._sizeX||this._size}get sizeY(){return this._sizeY||this._size}get sizeZ(){return this._sizeZ||this._size}faceExposed(t,i,n,s){const o=j[s],r=this.isSolid(this.idx3(t,i,n)),u=t+o[0],l=i+o[1],a=n+o[2],c=this.within(u,l,a)?this.isSolid(this.idx3(u,l,a)):!1;return r&&!c}seedMaterials(t="bands"){const i=this._sizeX||this._size,n=this._sizeY||this._size,s=this._sizeZ||this._size;for(let o=0;o<s;o++)for(let r=0;r<n;r++)for(let u=0;u<i;u++){const l=this.idx3(u,r,o),a=t==="random"?Math.random()*16|0:((u>>2)+(r>>2)+(o>>2))%16;this.setMaterial(l,a)}}buildGreedyRenderMeshMain(t,i,n){const s=o=>{if(!this.isSolid(o))return!1;for(const r of this._regions.values())if(r.contains(o))return!1;return!0};return this._buildGreedyRenderMesh(t,i,n,s)}buildGreedyRenderMeshRegion(t,i,n,s){const o=this._regions.get(s),r=u=>this.isSolid(u)?!!(o&&o.contains(u)):!1;return this._buildGreedyRenderMesh(t,i,n,r)}_buildGreedyRenderMesh(t,i,n,s){const o=[],r=[],u=[],l=[];let a=0;const c=this._sizeX||this._size,h=this._sizeY||this._size,f=this._sizeZ||this._size;for(let m=0;m<3;m++){const p=(m+1)%3,g=(m+2)%3,d=[c,h,f];for(let x=0;x<2;x++){const w=[0,0,0];w[m]=x===0?1:-1;for(let N=0;N<=d[m];N++){const I=new Array(d[p]*d[g]).fill(null);for(let v=0;v<d[g];v++)for(let b=0;b<d[p];b++){const A=[0,0,0];if(A[p]=b,A[g]=v,A[m]=x===0?N-1:N,!this.within(A[0],A[1],A[2]))continue;const S=this.idx3(A[0],A[1],A[2]);if(!s(S))continue;const y=[A[0]+w[0],A[1]+w[1],A[2]+w[2]];this.within(y[0],y[1],y[2])&&s(this.idx3(y[0],y[1],y[2]))||(I[b+d[p]*v]=this.material(S))}let _=0;for(;_<d[g];){let v=0;for(;v<d[p];){const b=I[v+d[p]*_];if(b==null){v++;continue}let A=1;for(;v+A<d[p]&&I[v+A+d[p]*_]===b;)A++;let S=1;t:for(;_+S<d[g];){for(let C=0;C<A;C++)if(I[v+C+d[p]*(_+S)]!==b)break t;S++}const y=[0,0,0];y[p]=v,y[g]=_,y[m]=N;const P=1e-6,R=y.slice(),F=y.slice();F[p]+=A;const B=F.slice();B[g]+=S;const L=y.slice();L[g]+=S;const E=[0,0,0];E[m]=w[m],R[m]+=w[m]*P,F[m]+=w[m]*P,B[m]+=w[m]*P,L[m]+=w[m]*P,o.push(R[0],R[1],R[2],F[0],F[1],F[2],B[0],B[1],B[2],L[0],L[1],L[2]),r.push(E[0],E[1],E[2],E[0],E[1],E[2],E[0],E[1],E[2],E[0],E[1],E[2]),u.push(b,b,b,b),w[m]>0?l.push(a,a+1,a+2,a,a+2,a+3):l.push(a,a+3,a+2,a,a+2,a+1),a+=4;for(let C=0;C<S;C++)for(let $=0;$<A;$++)I[v+$+d[p]*(_+C)]=null;v+=A}_++}}}}return t.bindVertexArray(n),t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ARRAY_BUFFER,new Float32Array(o),t.DYNAMIC_DRAW),t.enableVertexAttribArray(i.aPosition.location),t.vertexAttribPointer(i.aPosition.location,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.DYNAMIC_DRAW),t.enableVertexAttribArray(i.aNormal.location),t.vertexAttribPointer(i.aNormal.location,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ARRAY_BUFFER,new Uint8Array(u),t.DYNAMIC_DRAW),t.enableVertexAttribArray(i.aMatId.location),t.vertexAttribIPointer(i.aMatId.location,1,t.UNSIGNED_BYTE,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint32Array(l),t.DYNAMIC_DRAW),t.bindVertexArray(null),l.length}buildPickFaces(t,i){const n=[],s=[],o=[],r=[],u=[],l=[];let a=0,c=0;const h=[{axis:0,sign:1,u:2,v:1,id:0},{axis:0,sign:-1,u:2,v:1,id:1},{axis:1,sign:1,u:0,v:2,id:2},{axis:1,sign:-1,u:0,v:2,id:3},{axis:2,sign:1,u:0,v:1,id:4},{axis:2,sign:-1,u:0,v:1,id:5}],f=0,m=this._sizeX||this._size,p=this._sizeZ||this._size;for(let d=0;d<p;d++)for(let x=0;x<m;x++)for(let w=2;w<=2;w++){const N=this.idx3(x,f,d),I=[x,f,d],_=h[w],v=I.slice(),b=_.u,A=_.v,S=v.slice(),y=v.slice();y[b]+=1;const P=y.slice();P[A]+=1;const R=v.slice();R[A]+=1,r.push(S[0],S[1],S[2],y[0],y[1],y[2],P[0],P[1],P[2],R[0],R[1],R[2]);const F=N+1<<4|6;u.push(F,F,F,F),l.push(c,c+1,c+2,c,c+2,c+3),c+=4}const g=this._sizeY||this._size;for(let d=0;d<p;d++)for(let x=0;x<g;x++)for(let w=0;w<m;w++){const N=this.idx3(w,x,d);if(!this.isSolid(N))continue;const I=[w,x,d];for(const _ of h){if(!this.faceExposed(w,x,d,_.id))continue;const v=I.slice();v[_.axis]+=_.sign>0?1:0;const b=_.u,A=_.v,S=v.slice(),y=v.slice();y[b]+=1;const P=y.slice();P[A]+=1;const R=v.slice();R[A]+=1,n.push(S[0],S[1],S[2],y[0],y[1],y[2],P[0],P[1],P[2],R[0],R[1],R[2]);const F=N+1<<4|_.id&7;s.push(F,F,F,F),o.push(a,a+1,a+2,a,a+2,a+3),a+=4}}i.vaoGround||(i.vaoGround=t.createVertexArray()),t.bindVertexArray(i.vao),t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.DYNAMIC_DRAW),t.enableVertexAttribArray(i.aPosition.location),t.vertexAttribPointer(i.aPosition.location,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ARRAY_BUFFER,new Uint32Array(s),t.DYNAMIC_DRAW),t.enableVertexAttribArray(i.aPacked.location),t.vertexAttribIPointer(i.aPacked.location,1,t.UNSIGNED_INT,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint32Array(o),t.DYNAMIC_DRAW),t.bindVertexArray(i.vaoGround),t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),t.enableVertexAttribArray(i.aPosition.location),t.vertexAttribPointer(i.aPosition.location,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ARRAY_BUFFER,new Uint32Array(u),t.STATIC_DRAW),t.enableVertexAttribArray(i.aPacked.location),t.vertexAttribIPointer(i.aPacked.location,1,t.UNSIGNED_INT,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint32Array(l),t.STATIC_DRAW),t.bindVertexArray(null),i.meta.pickVoxelCount=o.length,i.meta.pickGroundCount=l.length}}export{At as A,M,tt as O,pt as P,yt as V,nt as a,it as b,st as c,ht as d,ft as e,rt as f,ut as g,G as h,ct as i,dt as j,mt as k,ot as l,et as m,lt as p,J as r,Q as t,at as w};
